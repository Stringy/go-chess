package be

import (

)

var (
	//number of white pieces
	wpawns,
		wrooks,
		wknights,
		wbishops,
		wqueens uint
	//number of black pieces
	bpawns,
		brooks,
		bknights, 
		bbishops, 
		bqueens uint
	//king position
	wkingsq, 
		bkingsq uint
	
	//material values
	whitemat,
		blackmat uint
	
	//totals
	wtotal, 
		btotal uint

	endgame bool
)

const (
	EndGameLim = 150
)

func EvalPositionValue(b *Board) int {
	score := b.Material

	//init king positions
	wkingsq = FirstOne(b.WhiteKing)
	bkingsq = FirstOne(b.BlackKing)

	//init white material values
	wpawns = BitCount(b.WhitePawns)
	wrooks = BitCount(b.WhiteRooks)
	wknights = BitCount(b.WhiteKnights)
	wbishops = BitCount(b.WhiteBishops)
	wqueens = BitCount(b.WhiteQueens)
	whitemat = (RookValue * wrooks) +
		(KnightValue * wknights) + 
		(BishopValue * wbishops) +
		(QueenValue * wqueens)
	wtotal = wpawns + wrooks + wbishops + wknights + wqueens

	//init black material values
	bpawns = BitCount(b.WhitePawns)
	brooks = BitCount(b.WhiteRooks)
	bknights = BitCount(b.WhiteKnights)
	bbishops = BitCount(b.WhiteBishops)
	bqueens = BitCount(b.WhiteQueens)
	blackmat = (RookValue * brooks) +
		(KnightValue * bknights) + 
		(BishopValue * bbishops) +
		(QueenValue * bqueens)
	btotal = bpawns + brooks + bbishops + bknights + bqueens

	//endgame defined by material on the board
	endgame = whitemat < EndGameLim || blackmat < EndGameLim

	return score
}

func evalDraw(b *Board) bool {
	if wpawns == 0 || bpawns == 0 {		
		//king vs king 
		if wtotal == 0 && btotal == 0 {
			return true
		}
		
		//king and knight vs. king 
		wkandn := (wtotal == KnightValue && wknights == 1) && btotal == 0
		bkandn := (btotal == KnightValue && bknights == 1) && wtotal == 0
		if wkandn || bkandn {
			return true
		}

		//two kings with one or more bishops 
		if wbishops + bbishops > 0 {
			onlywbish := (wknights == 0 && wrooks == 0 && wqueens == 0)
			onlybbish := (bknights == 0 && brooks == 0 && bqueens == 0)
			if onlywbish && onlybbish {
				//TODO
			}
		}
	} 
	return false 
}